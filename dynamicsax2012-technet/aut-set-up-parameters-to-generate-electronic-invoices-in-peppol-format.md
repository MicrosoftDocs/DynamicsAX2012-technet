---
title: (AUT) Set up parameters to generate electronic invoices in PEPPOL format
TOCTitle: (AUT) Set up parameters to generate electronic invoices in PEPPOL format
ms:assetid: 26ab8358-0e61-4678-9c57-0f7f6eba70b1
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn774180(v=AX.60)
ms:contentKeyID: 62629943
ms.date: 07/25/2014
mtps_version: v=AX.60
f1_keywords:
- eInvoice
- electronic invoicing
- Forms.AifPortDataPolicy
- Forms.BatchJob
- Forms.AifEndpointActionValueMap
- Forms.AifOutboundPort
- Forms.AifFileSystemConfiguration
- Forms.Batch
- Forms.AifPortActionPolicy
- outbound port
- PEPPOL
---

# (AUT) Set up parameters to generate electronic invoices in PEPPOL format 


_**Applies To:** Microsoft Dynamics AX 2012 R3_

This topic explains how to set up the following parameters that are required to generate and send electronic invoices (eInvoices) in the Pan-European Public e-Procurement On-Line (PEPPOL) format:

  - Folder structure for eInvoicing

  - Outbound ports in Microsoft Dynamics AX Application Integration Framework (AIF)

  - Batch processing to generate eInvoices periodically

## Prerequisites

The following table shows the prerequisites that must be in place before you start.

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Category</p></th>
<th><p>Prerequisite</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>Related setup tasks</strong></p></td>
<td><ul>
<li><p>Set up the inventory units according to the United Nations Center for Trade Facilitation and Electronic Business Information Content Management Group (UN/CEFACT ICG) standards in the <strong>Units</strong> form. For more information, see <a href="https://technet.microsoft.com/en-us/library/hh209233(v=ax.60)">Units (form)</a> and <a href="https://technet.microsoft.com/en-us/library/aa583814(v=ax.60)">External codes (form)</a>.</p></li>
<li><p>Set up a batch group that is used in batch processing to convert the invoice XML files to PEPPOL files. For more information, see <a href="https://technet.microsoft.com/en-us/library/aa575384(v=ax.60)">Batch groups (form)</a>.</p></li>
<li><p>Set up recurrence for batch jobs using the <strong>Recurrence</strong> form. For more information, see <a href="https://technet.microsoft.com/en-us/library/aa616143(v=ax.60)">Recurrence (form)</a>.</p></li>
</ul></td>
</tr>
</tbody>
</table>


## 1\. Set up a folder structure for eInvoicing

Set up folders to save error messages and invoices in the XML format and the PEPPOL format. The folders must be set up in a shared location that can be accessed from the Application Object Server (AOS) computer and from any client computers that are used as batch servers in your system.

Set up the following folder structure for sales invoices.

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Folder name</p></th>
<th><p>Purpose</p></th>
<th><p>Path</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Error</p></td>
<td><p>To save error messages that are generated when the XML file is converted to PEPPOL format.</p></td>
<td><p>\\Server\PEPPOL\Sales\Error</p></td>
</tr>
<tr class="even">
<td><p>Processed files</p></td>
<td><p>To save documents after they are processed. The documents are moved from the source folder to this folder.</p></td>
<td><p>\\Server\PEPPOL\Sales\Processed files</p></td>
</tr>
<tr class="odd">
<td><p>Source</p></td>
<td><p>To save the invoices that are generated by Microsoft Dynamics AX in the XML format.</p></td>
<td><p>\\Server\PEPPOL\Sales\Source</p></td>
</tr>
<tr class="even">
<td><p>Target</p></td>
<td><p>To save the invoice in PEPPOL format after the invoice in the XML format has been processed.</p></td>
<td><p>\\Server\PEPPOL\Sales\Target</p></td>
</tr>
<tr class="odd">
<td><p>XSLT</p></td>
<td><p>To store the eProjectInvoice.xsl and eSalesInvoice.xsl files, which are used to convert the eInvoices in the XML format to the PEPPOL format.</p></td>
<td><p>\\Server\PEPPOL\Sales\XSLT</p></td>
</tr>
</tbody>
</table>



> [!NOTE]
> <P>You can make similar folders for project invoices. For example, \\Server\PEPPOL\Project\Error.</P>



## 2\. Create outbound ports in AIF for eInvoicing

You can create an outbound port, configure the services and adapters for the outbound port, and specify the Microsoft Dynamics AX Application Integration Framework (AIF) settings that are required to generate the PEPPOL eInvoices.

You must scan for new adapters and services before you configure outbound ports for the first time. The port configuration is affected when there is a change in the Application Object Tree (AOT). You must also perform these scans each time a change that affects the port configuration is made to the AOT. For information about how to configure the enhanced integration port, go to [Managing integration ports](managing-integration-ports.md).

To create an outbound port in Microsoft Dynamics AX Application Integration Framework (AIF) for eInvoicing, follow these steps:

1.  Click **System administration** \> **Setup** \> **Services and Application Integration Framework** \> **Outbound ports**.

2.  Create an outbound port and enter the **Port name** and **Description** for the outbound port.

3.  In the **Adapter** field, select **File system adapter**. This adapter is used to create and save the PEPPOL eInvoices.

4.  In the **URI** field, specify the location of the source folder where you want to save the sales invoices.

5.  On the **Service contract customizations** FastTab, click **Service operations**.

6.  In the **Select service operations** form, select and move the **SalesSalesEInvoiceService.read**, **SalesSalesEInvoiceService.getKeys**, and **SalesSalesEInvoiceService.getChangedKeys** service operations to the **Selected service operations** list to make the sales invoices available for use by the port. Close the form.

7.  Select the **Customize documents** check box, and then click **Data policies**.

8.  In the **Document data policies** form, click **Enable all** to select all XML schema elements, and then close the form.

9.  Click the **Processing options** FastTab, and then in the **Default encoding format** field, select **UTF-8**.

10. Select the **Apply value mapping** check box, and then click **Value mapping** to open the **Value mapping** form. You can define the values, such as item number, customer account number, vendor account number, terms of delivery, and unit for the outbound port. Close the form. For more information, see [Value mapping (form)](https://technet.microsoft.com/en-us/library/aa586372\(v=ax.60\)).

11. Click the **Troubleshooting** FastTab, and then in the **Logging mode** field, select **All document versions**.

12. Optional: On the **Security** FastTab, in the **Restrict to company** field, select the legal entity for which the outbound port is exclusively available.

13. Click **Activate** to use the port to send eInvoices by using Microsoft Dynamics AX Application Integration Framework (AIF).

Repeat steps 2 through 13 to create an outbound port for project invoices. In the **URI** field, specify the source folder for the project invoices, and select **ProdProjEinvoiceService.Read**, **ProdProjEInvoiceService.getkeys**, and **ProdprojEInvoiceService.getChangedKeys** in the **Select service operations** form.

## 3\. Set up batch processing for eInvoicing

Use the **Batch job** form to set up batch processing for PEPPOL eInvoicing. You can process eInvoices by using batch jobs. For more information, see [Batch processing overview](batch-processing-overview.md).

You must set up a batch job for sales eInvoices, and another batch job for project eInvoices.

1.  Click **System administration** \> **Inquiries** \> **Batch jobs** \> **Batch jobs**.

2.  Create and save a batch job, and then click **View tasks**.

3.  In the **Batch tasks** form, create three batch tasks that use the following class names:
    
      - **AifOutboundProcessingService**
    
      - **AifGatewaySendService**
    
      - **EInvoiceFileTransform\_OIOUBL**

4.  Select the legal entity and the batch task that uses the **EInvoiceFileTransform\_OIOUBL** class name, and then in the **Batch group** field, select a batch group.

5.  Click **Refresh** to refresh the data in the form, and then click **Parameters**.

6.  In the **E-invoice OIOUBL XSL File Transformation** form, specify the locations of the source, target, processed, and error file storage folders. For the XSLT file path, select the path for the **eSalesInvoice.xsl** file for sales eInvoices, or the path for the **eProjectInvoice.xsl** file for project eInvoices, and then close the form.

7.  On the **Overview** tab, select the batch task that uses the **AifGatewaySendService** class name to set up the order in which the batch tasks are run.

8.  In the lower pane, press CTRL+N to create a condition for the selected batch task to run after the batch task that uses the **AifOutboundProcessingService** class name has ended.

9.  In the **Task ID** field, select the batch task that uses the **AifOutboundProcessingService** class name.

10. In the **Expected status** field, select **Ended**.
    

    > [!NOTE]
    > <P>You can also select the batch task that uses the <STRONG>EInvoiceFileTransform_OIOUBL</STRONG> class name, and then set the condition to run the batch task when the batch task that uses the <STRONG>AifGatewaySendService</STRONG> class name has ended.</P>



## Next step

[(AUT) Generate electronic invoices in PEPPOL format](aut-generate-electronic-invoices-in-peppol-format.md)

## Technical information for system administrators

If you don't have access to the pages that are used to complete this task, contact your system administrator and provide the information that is shown in the following table.

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Category</p></th>
<th><p>Prerequisite</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>Configuration keys</strong></p></td>
<td><p>No configuration key is required for this task.</p></td>
</tr>
<tr class="even">
<td><p><strong>Security role and duty</strong></p></td>
<td><p>To perform this task, you must have the following role:</p>
<ul>
<li><p><strong>Accounts receivable payments clerk</strong></p></li>
</ul>
<p>To set up parameters to generate electronic invoices in PEPPOL format, you must be a member of a security role that includes the following duty:</p>
<ul>
<li><p><strong>Maintain customer payments</strong> (PaymCustomerPaymentsMaintain)</p></li>
</ul></td>
</tr>
</tbody>
</table>

  
**Announcements:** To see known issues and recent fixes, use [Issue search](http://go.microsoft.com/fwlink/?linkid=389258) in [Microsoft Dynamics Lifecycle Services](http://go.microsoft.com/fwlink/?linkid=306505) (LCS).

